<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å¾’èŠ±ã®æ£˜æ‘˜ã¿</title>
  <style>
    :root {
      --background: #300;
      --text: #fff0f0;
      --accent: #faa;
    }
    html, body {
      max-width: 360px;
      margin: 0 auto;
      padding: 8px;
      font-family: sans-serif;
      background: var(--background);
      color: var(--text);
      touch-action: pan-y;
      user-select: none;
    }
    label {
      display: block;
      margin: 6px 0 2px;
      font-size: 14px;
    }
    fieldset {
      border: 1px solid var(--accent);
      padding: 8px;
      margin-bottom: 1em;
    }
    legend {
      padding: 0 6px;
      font-weight: bold;
    }
    textarea {
      width: 100%;
      margin-bottom: 8px;
      font-size: 14px;
      font-family: inherit;
      user-select: text;
      background: #fff;
      color: #000;
      padding: 4px;
      box-sizing: border-box;
    }
    input[type="file"],
    input[type="checkbox"],
    input[type="text"] {
      margin-bottom: 8px;
      font-size: 14px;
    }
    button {
      width: 100%;
      margin: 4px 0;
      padding: 8px;
      font-size: 14px;
      background: var(--accent);
      border: none;
      border-radius: 4px;
      user-select: none;
    }
    button:hover {
      filter: brightness(1.1);
      cursor: pointer;
    }
    #result {
      margin-top: 1em;
      font-size: 13px;
      color: #ffe;
      white-space: pre-wrap;
    }
    hr {
      border: 0;
      border-top: 1px solid var(--accent);
      margin: 16px 0;
    }
  </style>
</head>
<body>
  <h1 style="font-size: 16px; text-align: center; margin-bottom: 16px;">å¾’èŠ±ã®æ£˜æ‘˜ã¿</h1>

  <fieldset>
    <legend>ğŸ“ ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›</legend>
    <label for="text">ãƒ†ã‚­ã‚¹ãƒˆã‚’è²¼ã‚Šä»˜ã‘</label>
    <textarea id="text" rows="8" placeholder="ã“ã“ã«ãƒ†ã‚­ã‚¹ãƒˆã‚’è²¼ã£ã¦ã­â€¦"></textarea>
    <label for="loadTextFile">ğŸ“‚ ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã¿</label>
    <input type="file" id="loadTextFile" accept=".txt" />
  </fieldset>

  <fieldset>
    <legend>ğŸ” ãƒ‘ã‚¿ãƒ¼ãƒ³å…¥åŠ›</legend>
    <label for="pattern">æ¤œç´¢ç”¨æ­£è¦è¡¨ç¾ï¼ˆãƒ‘ã‚¤ãƒ— | åŒºåˆ‡ã‚Šï¼‰</label>
    <textarea id="pattern" rows="3" placeholder="æ¤œç´¢ç”¨æ­£è¦è¡¨ç¾ã‚’å…¥åŠ›â€¦"></textarea>
    <label for="loadPatternFile">ğŸ“‚ ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã¿</label>
    <input type="file" id="loadPatternFile" accept=".txt" />
  </fieldset>

  <fieldset>
    <legend>âš™ï¸ å‡ºåŠ›ã‚ªãƒ—ã‚·ãƒ§ãƒ³</legend>
    <label><input type="checkbox" id="addHyphen" checked /> å„è¡Œã«ã€Œ- ã€ã‚’ã¤ã‘ã‚‹ï¼ˆDynalistå‘ã‘ï¼‰</label>
    <label><input type="checkbox" id="inlineTagMode" /> å…¨æ–‡ã«ã‚¿ã‚°ã‚’ä»˜ã‘ã‚‹ï¼ˆå…¨æ–‡å‡ºåŠ›ãƒ¢ãƒ¼ãƒ‰ï¼‰</label>
    <label><input type="checkbox" id="showLineNumber" checked /> è¡Œç•ªå·ã‚’è¡¨ç¤ºã™ã‚‹</label>
    <label>ã‚¿ã‚°åï¼š<input type="text" id="tagText" value="#warn" /></label>
  </fieldset>

  <div>
    <button onclick="analyze()">ğŸ” æ£˜ãƒã‚§ãƒƒã‚¯</button>
    <button onclick="copyResult()">ğŸ“‹ çµæœã‚’ã‚³ãƒ”ãƒ¼</button>
    <button onclick="shareResult()">ğŸ“¤ çµæœã‚’å…±æœ‰</button>
    <button onclick="saveResult()">ğŸ’¾ çµæœã‚’ä¿å­˜ï¼ˆ.txtï¼‰</button>
  </div>

  <hr />

  <div>
    <button onclick="loadPreset()">ğŸ§ª ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿</button>
  </div>

  <div id="result"></div>

  <script>
    let lastSummary = "";

    function normalizeInput(text) {
      return text
        .split('\n')
        .map(line => line.replace(/^\s*-\s*/, ''))
        .join('\n');
    }

    function padLineNumber(n) {
      return String(n).padStart(2, '0');
    }

    function analyze() {
      const text = normalizeInput(document.getElementById("text").value);
      const pattern = document.getElementById("pattern").value.trim();
      const addHyphen = document.getElementById("addHyphen").checked;
      const inlineTagMode = document.getElementById("inlineTagMode").checked;
      const showLineNumber = document.getElementById("showLineNumber").checked;
      const tagText = document.getElementById("tagText").value.trim() || "";

      if (!pattern) {
        alert("æ¤œç´¢æ¡ä»¶ãŒç©ºã§ã™ï¼");
        return;
      }

      const regex = new RegExp(pattern, "g");
      const lines = text.split('\n');
      const resultLines = [];

      if (inlineTagMode) {
        lines.forEach((line, i) => {
          const matched = line.match(regex);
          const lineNumber = showLineNumber ? padLineNumber(i + 1) + ': ' : '';
          const prefix = addHyphen ? '- ' : '';
          const tagged = matched ? line + ' ' + tagText : line;
          resultLines.push(`${lineNumber}${prefix}${tagged}`);
        });
        lastSummary = resultLines.join('\n');
      } else {
        const matches = [];
        lines.forEach((line, i) => {
          if (line.match(regex)) {
            const lineNumber = showLineNumber ? padLineNumber(i + 1) + ': ' : '';
            const prefix = addHyphen ? '- ' : '';
            matches.push(`${lineNumber}${prefix}${line}`);
          }
        });
        lastSummary = matches.length
          ? `ğŸŒµ æ£˜ã£ã½ã„è¡¨ç¾ãŒ ${matches.length} ä»¶ è¦‹ã¤ã‹ã‚Šã¾ã—ãŸï¼š\n\n${matches.join('\n')}`
          : "ğŸª· ç‰¹ã«æ£˜ã£ã½ã„è¡¨ç¾ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚";
      }

      document.getElementById("result").textContent = lastSummary;
    }

    function copyResult() {
      if (!lastSummary) return alert("å…ˆã«æ£˜ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼");
      navigator.clipboard.writeText(lastSummary).then(() => alert("çµæœã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼"));
    }

    function shareResult() {
      if (!lastSummary) return alert("å…ˆã«æ£˜ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼");
      if (navigator.share) {
        navigator.share({
          title: "æ£˜æ‘˜ã¿ çµæœ",
          text: lastSummary
        }).catch(() => {});
      } else {
        alert("ã“ã®ç«¯æœ«ã§ã¯å…±æœ‰æ©Ÿèƒ½ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚");
      }
    }

    function saveResult() {
      if (!lastSummary) return alert("å…ˆã«æ£˜ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼");
      const blob = new Blob([lastSummary], { type: "text/plain" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "æ£˜æ‘˜ã¿_result.txt";
      a.click();
      URL.revokeObjectURL(url);
    }

    function loadPreset() {
      const sampleText = `ã“ã‚Œã¯ä¾‹ã®ãƒ†ã‚­ã‚¹ãƒˆã§ã™â€¦â€¦ï¼ï¼
- ã‚“ã»ã‰ãŠï¼ï¼Ÿ 
- ãƒ“ãƒ¥ãƒ«ãƒ«ãƒ«ã†ã†ï¼ï¼`;
      document.getElementById("text").value = normalizeInput(sampleText);
      document.getElementById("pattern").value =
`ã£|ï¼|â€¦|ï¼ï¼|ï¼ï¼Ÿ|ï¼Ÿï¼|ã€œ|([ã-ã‚“])\\1{1,}|[ã‚¢-ãƒ³ãƒ¼]{4,}|[ãŒ-ã½]{3,}|[â€"'ï¼ï¼Ÿ]{3,}|ã‚“ã»ã‰|ã‚â€ã‚â€|ãƒ“ãƒ¥ãƒ«|ã‚ºãƒãƒ¥|ã†ã”ã”`;
      alert("ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼");
    }

    document.getElementById("loadTextFile").addEventListener("change", function(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(e) {
        document.getElementById("text").value = normalizeInput(e.target.result);
      };
      reader.readAsText(file, "utf-8");
    });

    document.getElementById("loadPatternFile").addEventListener("change", function(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(e) {
        document.getElementById("pattern").value = e.target.result.trim();
      };
      reader.readAsText(file, "utf-8");
    });
  </script>
</body>
</html>